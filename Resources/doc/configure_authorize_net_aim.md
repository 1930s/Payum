## Configure Authorize.NET AIM

### Step 1. Download paypal payum lib

Add the following lines in your `composer.json` file:

```json
{
    "require": {
        "payum/authorize-net-aim": "dev-master",
        "ajbdev/authorizenet-php-api": "dev-master@dev"
    }
}
```

**Note:** You may want to adapt this line to use a specific version.

Now, run composer.phar to download the bundle:

```bash
$ php composer.phar install
```

**Note:** You can immediately start using it. The autoloading files have been generated by composer and already included to the app autoload file.

### Step 2: Configure payum bundle

```yaml

payum:
    contexts:
        simple_sell_authorize_net:
            create_instruction_from_model_action: payum.action.create_authorize_net_instruction_from_simple_sell
            authorize_net_aim_payment:
                api:
                    options:
                        login_id: ''
                        transaction_key: ''
                        sandbox: true
            filesystem_storage:
                model_class: Payum\Domain\SimpleSell
                storage_dir: %kernel.root_dir%\Resources\payments
                id_property: id
```

Lets describe some parts of the config. 
Payum bundle uses contexts to handle payments. 
You can have as many context as you want.
It is up to you how to name the content. 
We choose filesystem as storage, you may want to use doctrine storage.
You should take api options from Authorize.NET side and put them to `api.options` section. 
Also you should not forget to set `sandbox` option to false in production use. 

**Note:** Dont forget to configure api options properly. 

### Step 3: Configure create instruction action

First we have to create payum action. This action create payment specific instruction from your model. 

```php
<?php
namespace AcmeDemoBundle\Payum\Action;

use Symfony\Component\DependencyInjection\ContainerInterface;

use Payum\Action\ActionPaymentAware;
use Payum\Request\CaptureRequest;
use Payum\Domain\InstructionAggregateInterface;
use Payum\Domain\InstructionAwareInterface;
use Payum\Exception\RequestNotSupportedException;
use Payum\AuthorizeNet\Aim\PaymentInstruction;

class CaptureSimpleSellWithAuthorizeNetAimAction extends ActionPaymentAware 
{
    protected $container;
    
    public function __construct(ContainerInterface $container)
    {
        $this->container = $container;
    }
    
    /**
     * {@inheritdoc}
     */
    public function execute($request)
    {
        /** @var $request CaptureRequest */
        if (false == $this->supports($request)) {
            throw RequestNotSupportedException::createActionNotSupported($this, $request);
        }

        $simpleSell = $request->getModel();
        
        $instruction = new PaymentInstruction;
        $instruction->setAmount((float) number_format($simpleSell->getPrice(), 2) * 100);
        $instruction->setClientemail('user@email.com');
        $instruction->setCardNum($this->container->get('request')->get('card_num'));
        $instruction->setExpDate($this->container->get('request')->get('card_num'));
        $instruction->setAmount($simpleSell->getPrice());
        
        $this->payment->execute(new CaptureRequest($instruction));
    }

    /**
     * {@inheritdoc}
     */
    public function supports($request)
    {
        return
            $request instanceof CaptureRequest &&
            $request->getModel() instanceof SimpleSell
        ;
    }
}
```

Second we have to add this service to container.

```yaml
services:
    payum.action.capture_simple_sell_with_authorize_net:
        class:                                                    AcmeDemoBundle\Payum\Action\CaptureSimpleSellWithAuthorizeNetAimAction
        arguments:
            -                                                     @service_container
            
payum:
    context:
        your_context:
            authorize_net_aim_payment:
                #..
                actions:
                    - payum.action.capture_simple_sell_with_authorize_net
```

### Next Step

Now you are ready to read [how to capture payment](capture_payment.md).